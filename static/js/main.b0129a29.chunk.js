(this["webpackJsonpwebrtc-video-conference-client"]=this["webpackJsonpwebrtc-video-conference-client"]||[]).push([[0],{113:function(e,t){},115:function(e,t){},142:function(e,t,n){"use strict";n.r(t);var i,r,c,s,o=n(0),a=n.n(o),d=n(73),u=n.n(d),v=(n(86),n(87),n(20)),l=n(21),h=l.b.button(i||(i=Object(v.a)(["\n  padding: 0.5em 1em;\n  border-style: solid;\n  border-width: 2px;\n  border-color: #005450;\n  border-radius: 3px;\n  background-color: #005450;\n  color: white;\n  font-weight: 800;\n  font-size: 1em;\n  cursor: pointer;\n\n  &:hover {\n    opacity: 0.75;\n  }\n\n  &:focus {\n    outline: none;\n  }\n\n  ","\n"])),(function(e){return e.disabled&&Object(l.a)(r||(r=Object(v.a)(["\n      opacity: 0.75;\n    "])))})),f=l.b.select(c||(c=Object(v.a)(["\n  padding: 10px;\n  border-style: solid;\n  border-width: 1px;\n  border-radius: 3px;\n  border-color: #353640;\n  color: #353640;\n  font-weight: 800;\n  font-size: 1em;\n  cursor: pointer;\n\n  &:focus {\n    outline: none;\n  }\n\n  ","\n"])),(function(e){return e.width&&Object(l.a)(s||(s=Object(v.a)(["\n      width: ",";\n    "])),e.width)})),j=n(19),b=n(2),m=n(3),O=n(10),g=n(11),p=function e(){var t=this;Object(m.a)(this,e),this.listeners={},this.listen=function(e,n){var i;t.listeners[e]||(t.listeners[e]=[]),null===(i=t.listeners[e])||void 0===i||i.push(n)},this.fire=function(e){for(var n,i=arguments.length,r=new Array(i>1?i-1:0),c=1;c<i;c++)r[c-1]=arguments[c];null===(n=t.listeners[e])||void 0===n||n.forEach((function(e){e.apply(void 0,r)}))},this.unlisten=function(e,n){var i;null===(i=t.listeners[e])||void 0===i||i.forEach((function(e){return e!==n}))}};function x(e){return function(e){Object(O.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(m.a)(this,n);for(var i=arguments.length,r=new Array(i),c=0;c<i;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).eventHandler=new p,e.addEventListener=function(t,n){e.eventHandler.listen(t,n)},e.removeEventListener=function(t,n){e.eventHandler.unlisten(t,n)},e}return n}(e)}var C=p,S=n(80),D=function(e){Object(O.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(m.a)(this,n);for(var i=arguments.length,r=new Array(i),c=0;c<i;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).isMuted=!1,e.isHidden=!1,e.toggleVideo=function(){e.isHidden=!e.isHidden,e.getVideoTracks().forEach((function(t){t.enabled=e.isHidden}))},e.toggleAudio=function(){e.isMuted=!e.isMuted,e.getAudioTracks().forEach((function(t){t.enabled=e.isMuted}))},e.hide=function(){e.isHidden=!1,e.toggleVideo()},e.show=function(){e.isHidden=!0,e.toggleVideo()},e.mute=function(){e.isMuted=!1,e.toggleAudio()},e.unmute=function(){e.isMuted=!0,e.toggleAudio()},e}return n}(function(e){Object(O.a)(n,e);var t=Object(g.a)(n);function n(){var e;Object(m.a)(this,n);for(var i=arguments.length,r=new Array(i),c=0;c<i;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).removeTracks=function(){e.getTracks().forEach((function(t){t.stop(),e.removeTrack(t)}))},e.addTracks=function(t){t.forEach((function(t){e.addTrack(t)}))},e.updateStream=function(t){e.removeTracks(),e.addTracks(t.getTracks())},e.stopStream=function(){e.getTracks().forEach((function(e){e.stop()}))},e}return n}(Object(S.a)(MediaStream))),w=x((function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Object(m.a)(this,e),this.name=void 0,this.email=void 0,this.stream=void 0,this.eventHandler=void 0,this.getName=function(){return t.name},this.setName=function(e){t.name=e,t.eventHandler.fire("onNameChange",e)},this.getEmail=function(){return t.email},this.setEmail=function(e){t.email=e,t.eventHandler.fire("onEmailChange",e)},this.getStream=function(){return t.stream},this.setStream=function(e){t.stream.updateStream(e)},this.name=n,this.email=i,this.stream=new D,this.eventHandler=new C})),k=n(12),E=n.n(k),y=n(29),P=n(13),H=n(44),I=x((function e(){var t=this;Object(m.a)(this,e),this.constraints={video:!0,audio:!0},this.videoDevices=[],this.audioDevices=[],this.stream=new MediaStream,this.eventHandler=new C,this.handleDeviceChange=Object(y.a)(E.a.mark((function e(){var n,i,r;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:n=e.sent,i=n.filter((function(e){return"videoinput"===e.kind})).sort(),Object(H.isEqual)(i,t.videoDevices)||(t.videoDevices=i,t.eventHandler.fire("onVideoDeviceChange",t.videoDevices)),r=n.filter((function(e){return"audioinput"===e.kind})).sort(),Object(H.isEqual)(r,t.audioDevices)||(t.audioDevices=r,t.eventHandler.fire("onAudioDeviceChange",t.audioDevices));case 7:case"end":return e.stop()}}),e)}))),this.updateConstraints=function(e){t.constraints=Object(P.a)(Object(P.a)({},t.constraints),e)},this.selectVideoDeviceById=function(e){t.updateConstraints({video:{deviceId:e}}),t.requestStream()},this.selectAudioDeviceById=function(e){t.updateConstraints({audio:{deviceId:e}}),t.requestStream()},this.requestStream=Object(y.a)(E.a.mark((function e(){var n;return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.getUserMedia(t.constraints);case 2:return n=e.sent,e.next=5,t.handleDeviceChange();case 5:t.stream.getTracks().forEach((function(e){e.stop(),t.stream.removeTrack(e)})),n.getTracks().forEach((function(e){t.stream.addTrack(e)})),t.eventHandler.fire("onStreamChange",n),t.eventHandler.fire("onSelectedVideoDeviceChange",t.getSelectedVideoDevice()),t.eventHandler.fire("onSelectedAudioDeviceChange",t.getSelectedAudioDevice());case 10:case"end":return e.stop()}}),e)}))),this.getStream=function(){return t.stream},this.getSelectedDevice=function(e,t,n){if(e)return t.find((function(t){return e.getTracks().filter((function(e){return e.kind===n})).find((function(e){return e.label===t.label}))}))},this.getSelectedVideoDevice=function(){return t.getSelectedDevice(t.stream,t.videoDevices,"video")},this.getSelectedAudioDevice=function(){return t.getSelectedDevice(t.stream,t.audioDevices,"audio")},navigator.mediaDevices.addEventListener("devicechange",this.handleDeviceChange)})),A=n(1),L=a.a.createContext({stream:new MediaStream,videoDevices:[],audioDevices:[],selectVideoDeviceById:function(){},selectAudioDeviceById:function(){},requestPermission:function(){var e=Object(y.a)(E.a.mark((function e(){return E.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),M=function(){var e=a.a.useContext(L);if(void 0===e)throw new Error("useDevice must be used within a WebRTCDeviceManagerProvider");return e},V=function(e){var t=e.children,n=Object(o.useRef)(new I).current,i=Object(o.useState)([]),r=Object(b.a)(i,2),c=r[0],s=r[1],a=Object(o.useState)([]),d=Object(b.a)(a,2),u=d[0],v=d[1],l=Object(o.useState)(),h=Object(b.a)(l,2),f=h[0],j=h[1],m=Object(o.useState)(),O=Object(b.a)(m,2),g=O[0],p=O[1],x=Object(o.useState)(n.getStream()),C=Object(b.a)(x,2),S=C[0],D=C[1];Object(o.useEffect)((function(){return n.addEventListener("onStreamChange",D),n.addEventListener("onVideoDeviceChange",s),n.addEventListener("onAudioDeviceChange",v),n.addEventListener("onSelectedVideoDeviceChange",j),n.addEventListener("onSelectedAudioDeviceChange",p),function(){n.removeEventListener("onStreamChange",D),n.removeEventListener("onVideoDeviceChange",s),n.removeEventListener("onAudioDeviceChange",v),n.removeEventListener("onSelectedVideoDeviceChange",j),n.removeEventListener("onSelectedAudioDeviceChange",p)}}),[n]);var w=Object(o.useMemo)((function(){return{stream:S,videoDevices:c,audioDevices:u,selectedVideoDevice:f,selectedAudioDevice:g,selectVideoDeviceById:n.selectVideoDeviceById,selectAudioDeviceById:n.selectAudioDeviceById,requestPermission:n.requestStream}}),[S,c,u,f,g,n]);return Object(A.jsx)(L.Provider,{value:w,children:t})},T=a.a.createContext(void 0),N=function(){var e=a.a.useContext(T);if(void 0===e)throw new Error("useUser must be used within a UserProvider");return e},R=function(e){var t=e.children,n=M().stream,i=Object(o.useRef)(new w).current,r=Object(o.useState)(""),c=Object(b.a)(r,2),s=c[0],d=c[1],u=Object(o.useState)(""),v=Object(b.a)(u,2),l=v[0],h=v[1],f=Object(o.useRef)(i.getStream()).current;Object(o.useEffect)((function(){return i.addEventListener("onNameChange",d),i.addEventListener("onEmailChange",h),i.setStream(n),function(){i.removeEventListener("onNameChange",d),i.removeEventListener("onEmailChange",h)}}),[i,n]);var j=a.a.useMemo((function(){return{name:s,email:l,user:i,videoStream:f,updateName:i.setName,updateEmail:i.setEmail}}),[s,l,f,i]);return Object(A.jsx)(T.Provider,{value:j,children:t})},B=n(81);function q(e){var t=e.srcObject,n=e.withControls,i=void 0!==n&&n,r=Object(B.a)(e,["srcObject","withControls"]),c=Object(o.useRef)(null),s=Object(o.useState)(!0),a=Object(b.a)(s,2),d=a[0],u=a[1],v=Object(o.useState)(!0),l=Object(b.a)(v,2),f=l[0],j=l[1];Object(o.useEffect)((function(){c.current&&(c.current.srcObject=t)}),[t]);var m=Object(o.useCallback)((function(){u(!d),t.getVideoTracks().forEach((function(e){e.enabled=!d}))}),[d,t]),O=Object(o.useCallback)((function(){j(!f),t.getAudioTracks().forEach((function(e){e.enabled=!f}))}),[f,t]);return Object(A.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"black"},children:Object(A.jsxs)("div",{style:{position:"relative"},children:[Object(A.jsx)("video",Object(P.a)({ref:c},r)),Object(A.jsx)("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:"3px",display:"flex",alignItems:"flex-end",justifyContent:"center"},children:i&&Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)("div",{style:{margin:"10px 5px"},children:Object(A.jsx)(h,{onClick:m,children:d?"Hide Video":"Show Video"})}),Object(A.jsx)("div",{style:{margin:"10px 5px"},children:Object(A.jsx)(h,{onClick:O,children:f?"Mute Audio":"Unmute Audio"})})]})})]})})}var U=function(e){var t=M(),n=t.stream,i=t.videoDevices,r=t.audioDevices,c=t.selectedVideoDevice,s=t.selectedAudioDevice,a=t.selectVideoDeviceById,d=t.selectAudioDeviceById,u=t.requestPermission,v=N(),l=v.name,b=v.updateName;Object(o.useEffect)((function(){u()}),[u]);var m=Object(o.useRef)((function(e){b(e.target.value)})).current,O=Object(o.useRef)((function(e){a(e.target.value)})).current,g=Object(o.useRef)((function(e){d(e.target.value)})).current;return Object(A.jsx)("div",{className:"DeviceDiscoveryPage",children:Object(A.jsxs)("div",{className:"DeviceDiscoveryPage-container",children:[Object(A.jsx)("div",{children:Object(A.jsx)(q,{srcObject:n,muted:!0,autoPlay:!0,playsInline:!0})}),Object(A.jsx)("div",{children:Object(A.jsx)("input",{type:"text",value:l,onChange:m,placeholder:"Your Name",className:"DeviceDiscoveryPage-name"})}),Object(A.jsx)("div",{children:Object(A.jsx)(f,{width:"100%",value:null===c||void 0===c?void 0:c.deviceId,onChange:O,children:i.map((function(e){return Object(A.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)}))})}),Object(A.jsx)("div",{children:Object(A.jsx)(f,{width:"100%",value:null===s||void 0===s?void 0:s.deviceId,onChange:g,children:r.map((function(e){return Object(A.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)}))})}),Object(A.jsx)("div",{children:Object(A.jsx)(j.a,{to:"/conference",children:Object(A.jsx)(h,{disabled:l.length<3,children:"Enter Room"})})})]})})};n(97);var J=function(e){return Object(A.jsx)("div",{className:"HomePage",children:Object(A.jsxs)("div",{children:[Object(A.jsx)("h1",{children:"Video Conference"}),Object(A.jsx)(j.a,{to:"/deviceDiscovery",children:Object(A.jsx)(h,{children:"Start"})})]})})},z=(n(98),n(78)),F=x(function(e){Object(O.a)(n,e);var t=Object(g.a)(n);function n(e,i,r){var c;return Object(m.a)(this,n),(c=t.call(this,Object(P.a)({},r))).socket=void 0,c.user=void 0,c.socketId=void 0,c.eventHandler=void 0,c.onSignal=function(e){c.socket.emit("signal",{signal:e,socketId:c.socketId})},c.onStream=function(e){c.eventHandler.fire("onStream",e),c.user.setStream(e)},c.stopStream=function(){c.user.getStream().stopStream()},c.getUser=function(){return c.user},c.socket=e,c.user=new w,c.socketId=i,c.eventHandler=new C,c.on("signal",c.onSignal),c.on("stream",c.onStream),c}return n}(n.n(z).a)),W=x((function e(t,n,i){var r=this;Object(m.a)(this,e),this.socket=void 0,this.user=void 0,this.peers=void 0,this.eventHandler=void 0,this.configuration=void 0,this.connect=function(){r.socket.connect(),r.socket.on("newCaller",r.newCaller),r.socket.on("receivedCall",r.receivedCall),r.socket.on("signal",r.signal),r.socket.on("removePeer",r.removePeer),r.socket.on("disconnect",r.disconnect)},this.addPeer=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];r.peers[e]=new F(r.socket,e,{stream:r.user.getStream(),config:r.configuration,initiator:t})},this.newCaller=function(e){r.socket.emit("receivedCall",e),r.addPeer(e),r.eventHandler.fire("onConnect",Object.keys(r.peers).map((function(e){return r.peers[e]})))},this.receivedCall=function(e){r.addPeer(e,!0),r.eventHandler.fire("onConnect",Object.keys(r.peers).map((function(e){return r.peers[e]})))},this.signal=function(e){r.peers[e.socketId]&&r.peers[e.socketId].signal(e.signal)},this.removePeer=function(e){r.peers[e]&&(r.peers[e].stopStream(),r.peers[e]&&r.peers[e].destroy(),delete r.peers[e],r.eventHandler.fire("onDisconnect",Object.keys(r.peers).map((function(e){return r.peers[e]}))))},this.disconnect=function(){for(var e in r.peers)r.removePeer(e)},this.peers={},this.user=n,this.socket=t,this.eventHandler=new C,this.configuration=i})),Y={iceServers:[{urls:"stun:stun.l.google.com:19302"},{url:"turn:192.158.29.39:3478?transport=udp",credential:"JZEOEt2V3Qb0y27GRntt2u2PAYA=",username:"28224511:1379330808"}]},G=n(79),Q=n.n(G),Z=a.a.createContext(void 0),K=function(){var e=Object(o.useContext)(Z);if(void 0===e)throw new Error("useSocket must be used within a SocketProvider");return e},X=function(e){var t=e.endpoint,n=void 0===t?"http://localhost:5000/":t,i=e.children,r=Object(o.useRef)(Q()(n,{autoConnect:!1})).current;return Object(A.jsx)(Z.Provider,{value:r,children:i})},$=a.a.createContext(void 0),_=function(e){var t=e.children,n=K(),i=N().user,r=Object(o.useState)([]),c=Object(b.a)(r,2),s=c[0],a=c[1],d=Object(o.useRef)(new W(n,i,Y)).current;Object(o.useEffect)((function(){return d.addEventListener("onConnect",a),d.addEventListener("onDisconnect",a),function(){d.removeEventListener("onConnect",a),d.removeEventListener("onDisconnect",a)}}),[d]);var u=Object(o.useMemo)((function(){return{connect:d.connect,peers:s}}),[d,s]);return Object(A.jsx)($.Provider,{value:u,children:t})},ee=n(45),te=x((function e(t){var n=this;Object(m.a)(this,e),this.socket=void 0,this.messages=void 0,this.eventHandler=void 0,this.receive=function(e){n.messages.push(e),n.eventHandler.fire("onReceive",Object(ee.a)(n.messages))},this.send=function(e){n.messages.push({message:e,username:"Me"}),n.eventHandler.fire("onSend",Object(ee.a)(n.messages)),n.socket.emit("sendMessage",e)},this.getMessages=function(){return n.messages},this.socket=t,this.messages=[],this.socket.on("receiveMessage",this.receive),this.eventHandler=new C})),ne=a.a.createContext(void 0),ie=function(e){var t=e.children,n=K(),i=Object(o.useState)([]),r=Object(b.a)(i,2),c=r[0],s=r[1],a=Object(o.useRef)(new te(n)).current;Object(o.useEffect)((function(){return a.addEventListener("onReceive",s),a.addEventListener("onSend",s),function(){a.removeEventListener("onReceive",s),a.removeEventListener("onSend",s)}}),[a]);var d=Object(o.useMemo)((function(){return{messages:c,sendMessage:a.send}}),[c,a]);return Object(A.jsx)(ne.Provider,{value:d,children:t})};var re=function(e){var t=M(),n=t.stream,i=t.requestPermission,r=N().user,c=K(),s=function(){var e=Object(o.useContext)($);if(void 0===e)throw new Error("usePeerManager must be used within a PeerManagerProvider");return e}(),a=s.connect,d=s.peers,u=Object(o.useState)(""),v=Object(b.a)(u,2),l=v[0],f=v[1],j=function(){var e=Object(o.useContext)(ne);if(void 0===e)throw new Error("useChat must be used within a ChatProvider");return e}(),m=j.messages,O=j.sendMessage;Object(o.useEffect)((function(){i().then((function(){c.auth={username:r.name},a()}))}),[i,a,c,r]);var g=Object(o.useRef)((function(e){f(e.target.value)})).current,p=Object(o.useCallback)((function(e){""!==l&&(O(l),f("")),e.preventDefault()}),[l,O]);return Object(A.jsx)(A.Fragment,{children:Object(A.jsxs)("div",{className:"ConferencePage",children:[Object(A.jsxs)("div",{className:"ConferencePage-video-container",children:[Object(A.jsx)(q,{srcObject:n,muted:!0,autoPlay:!0,playsInline:!0,withControls:!0}),d.map((function(e,t){return Object(A.jsx)(q,{srcObject:e.getUser().getStream(),autoPlay:!0,playsInline:!0,style:{maxWidth:"50vw",maxHeight:"50vh"}},t.toString())}))]}),Object(A.jsxs)("div",{className:"ConferencePage-chat",children:[Object(A.jsx)("p",{className:"ConferencePage-chat-messages",children:m.map((function(e,t){return Object(A.jsx)("div",{children:Object(A.jsxs)("span",{children:[e.username,": ",e.message]})},t.toString())}))}),Object(A.jsx)("form",{onSubmit:p,children:Object(A.jsxs)("div",{className:"ConferencePage-chat-field",children:[Object(A.jsx)("input",{type:"text",value:l,onChange:g,placeholder:"Send a message"}),Object(A.jsx)(h,{type:"submit",children:"Send"})]})})]})]})})};var ce=function(){return Object(A.jsx)(V,{children:Object(A.jsx)(R,{children:Object(A.jsx)(X,{endpoint:"https://webrtc-video-conference-server.herokuapp.com/",children:Object(A.jsx)(_,{children:Object(A.jsx)(ie,{children:Object(A.jsxs)(j.b,{children:[Object(A.jsx)(J,{path:"/",default:!0}),Object(A.jsx)(U,{path:"/deviceDiscovery"}),Object(A.jsx)(re,{path:"/conference"})]})})})})})})};u.a.render(Object(A.jsx)(a.a.StrictMode,{children:Object(A.jsx)(ce,{})}),document.getElementById("root"))},86:function(e,t,n){},87:function(e,t,n){},97:function(e,t,n){},98:function(e,t,n){}},[[142,1,2]]]);
//# sourceMappingURL=main.b0129a29.chunk.js.map